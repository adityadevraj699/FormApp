<html th:replace="~{Student/Studentbase::layout(~{::main})}">
<body>
<main class="container my-5">

    <!-- Profile Header -->
    <div class="card shadow-lg rounded-4 mb-5 border-0">
        <div class="card-body d-flex flex-column flex-md-row align-items-center p-4">
            
            <!-- Profile Image (with default fallback using first letter) -->
            <div class="text-center me-md-5 mb-3 mb-md-0">
                <div th:if="${student.profileImage != null}">
                    <img th:src="@{${student.profileImage}}"
                         class="rounded-circle border border-4 border-primary shadow-sm"
                         alt="Profile Image" width="160" height="160">
                </div>
                <div th:if="${student.profileImage == null}"
                     class="rounded-circle border border-4 border-primary d-flex align-items-center justify-content-center shadow-sm"
                     style="width:160px; height:160px; background-color:#f0f2f5; font-size:48px; color:#495057; font-weight:bold;">
                    <span th:text="${student.name != null ? student.name.substring(0,1) : 'S'}">S</span>
                </div>
            </div>

            <!-- Name & Role -->
            <div class="flex-grow-1 text-center text-md-start">
                <h3 th:text="${student.name}" class="fw-bold mb-1">Student Name</h3>
                <span class="badge bg-primary fs-6 py-2 px-3" th:text="${student.role}">STUDENT</span>
                <div class="mt-3">
                    <p class="mb-2"><i class="fa-solid fa-envelope me-2 text-secondary"></i><span th:text="${student.email}">email@example.com</span></p>
                    <p class="mb-2"><i class="fa-solid fa-phone me-2 text-secondary"></i><span th:text="${student.contactNo}">+91-1234567890</span></p>
                    <p class="mb-0"><i class="fa-solid fa-graduation-cap me-2 text-secondary"></i>
                        <span th:text="${student.branch + ' - ' + student.year}">CSE - 1st Year</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Details -->
    <div class="row g-4 mb-5">
        <div class="col-md-6">
            <div class="card shadow-sm rounded-4 border-0 h-100">
                <div class="card-header bg-primary text-white fw-bold fs-6 rounded-top-4">Personal Info</div>
                <div class="card-body p-4">
                    <p th:if="${student.fatherName != null}"><strong>Father Name:</strong> <span th:text="${student.fatherName}"></span></p>
                    <p th:if="${student.motherName != null}"><strong>Mother Name:</strong> <span th:text="${student.motherName}"></span></p>
                    <p th:if="${student.gender != null}"><strong>Gender:</strong> <span th:text="${student.gender}"></span></p>
                    <p th:if="${student.address != null}"><strong>Address:</strong> <span th:text="${student.address}"></span></p>
                    <p th:if="${student.regDate != null}"><strong>Registered On:</strong>
                        <span th:text="${#temporals.format(student.regDate, 'dd MMM yyyy')}"></span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="col-md-6">
            <div class="d-flex flex-column gap-3 h-100">
                <a th:href="@{/Student/EditProfile}" class="btn btn-warning w-100 py-2 fw-bold shadow-sm rounded-4">
                    <i class="fa-solid fa-pen-to-square me-2"></i>Edit Profile
                </a>
                <a th:href="@{/logout}" class="btn btn-danger w-100 py-2 fw-bold shadow-sm rounded-4">
                    <i class="fa-solid fa-right-from-bracket me-2"></i>Logout
                </a>
            </div>
        </div>
    </div>

    <style>
        .card:hover {
            transform: translateY(-5px);
            transition: all 0.3s ease-in-out;
        }
        .badge {
            font-size: 0.95rem;
            padding: 0.5em 0.8em;
            text-transform: uppercase;
        }
        .card-header {
            font-size: 1rem;
        }
        body {
            background-color: #f8f9fa;
        }
    </style>
<!-- Hidden input to pass flash message -->
<input type="hidden" id="serverMessage" 
       th:value="${success != null ? success : (error != null ? error : '')}" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const serverMessage = document.getElementById("serverMessage")?.value;

  if (serverMessage && serverMessage.trim() !== "") {
    // Lowercase version for easy keyword matching
    const lowerMsg = serverMessage.toLowerCase();

    // Error check (keywords)
    const isError = lowerMsg.includes('invalid') || 
                    lowerMsg.includes('failed') || 
                    lowerMsg.includes('error') || 
                    lowerMsg.includes('not found');

    Swal.fire({
      title: isError ? 'Error' : 'Success',
      text: serverMessage,
      icon: isError ? 'error' : 'success',
      confirmButtonColor: '#2575fc',
      background: '#f9f9f9',
      color: '#333',
      timer: 4000,
      timerProgressBar: true
    });
  }
});
</script>

</main>
</body>
</html>
